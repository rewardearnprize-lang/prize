<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Loading offer...</title>
  <script>
    (async () => {
      const params = new URLSearchParams(window.location.search);
      const offerUrl = params.get("url");
      const subid = params.get("subid");
      const redirect = params.get("redirect");

      if (!offerUrl || !subid) {
        document.body.innerHTML = "<h2 style='color:white'>Missing parameters</h2>";
        return;
      }

      // 🔹 سجل المفتاح محلياً أو أرسله إلى سيرفرك لتتبعه
      try {
        await fetch(`https://ogads-postback.vercel.app/api/pretrack?key=${subid}`);
      } catch (e) {
        console.warn("Pretrack error:", e);
      }

      // 🔹 أضف sub1 للمفتاح في رابط العرض
      const finalUrl = offerUrl.includes("?")
        ? `${offerUrl}&sub1=${subid}`
        : `${offerUrl}?sub1=${subid}`;

      // 🔹 افتح العرض في تبويب جديد (يحتوي على المفتاح)
      window.open(finalUrl, "_blank");

      // 🔹 بعد 4 ثوانٍ، أعد المستخدم لموقعك (صفحة النجاح)
      setTimeout(() => {
        window.location.href = redirect || "https://prize-xi.vercel.app/";
      }, 4000);
    })();
  </script>
</head>
<body style="background:black; color:white; display:flex; align-items:center; justify-content:center; height:100vh; font-family:sans-serif;">
  <h2>Preparing your offer...</h2>
</body>
</html>
